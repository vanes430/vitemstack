name: Bump Version

on:
  workflow_dispatch:
    inputs:
      version_type:
        description: 'Version Bump Type (patch, minor, major)'
        required: true
        default: 'patch'
        type: choice
        options:
        - patch
        - minor
        - major

jobs:
  bump-version:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'maven'

      - name: Configure Git User
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Bump Version
        run: |
          # Get current version from pom.xml
          CURRENT_VERSION=$(mvn help:evaluate -Dexpression=project.version -q -DforceStdout)
          echo "Current Version: $CURRENT_VERSION"
          
          # Remove -SNAPSHOT if present to calculate clean version numbers
          CLEAN_VERSION=${CURRENT_VERSION%-SNAPSHOT}
          
          IFS='.' read -r -a parts <<< "$CLEAN_VERSION"
          major=${parts[0]}
          minor=${parts[1]}
          patch=${parts[2]}
          
          if [ "${{ inputs.version_type }}" == "major" ]; then
            major=$((major + 1))
            minor=0
            patch=0
          elif [ "${{ inputs.version_type }}" == "minor" ]; then
            minor=$((minor + 1))
            patch=0
          else
            patch=$((patch + 1))
          fi
          
          NEW_VERSION="$major.$minor.$patch"
          echo "New Version: $NEW_VERSION"
          
          # Update version using Maven Versions Plugin
          mvn versions:set -DnewVersion=$NEW_VERSION -DgenerateBackupPoms=false
          
          # Commit and Push
          git add .
          git commit -m "chore: bump version to $NEW_VERSION"
          git push
